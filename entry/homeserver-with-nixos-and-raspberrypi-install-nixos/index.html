<!doctype html><html lang=ja><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=https://blog.ymgyt.io/favicon.ico rel=icon sizes=any><link href=https://blog.ymgyt.io/icon.svg rel=icon type=image/svg+xml><link href=https://blog.ymgyt.io/apple-touch-icon.png rel=apple-touch-icon><link href=https://blog.ymgyt.io/manifest.webmanifest rel=manifest><link href=https://blog.ymgyt.io/style.css rel=stylesheet><link href=https://blog.ymgyt.io/atom.xml rel=alternate title=Atom type=application/atom+xml><script src="https://www.googletagmanager.com/gtag/js?id=G-GTB0KMLN90" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[];gtag(`js`,new Date());gtag(`config`,`G-GTB0KMLN90`)</script><title>â„ï¸ NixOSã¨Raspberry Piã§è‡ªå®…server | Part 1 NixOSã‚’install | Happy developing</title><meta content="Raspberry Piã¸ã®NixOSã®installã«ã¤ã„ã¦" name=description><meta content=summary name=twitter:card><meta content="@YAmaguchixt " name=twitter:site><meta content="â„ï¸ NixOSã¨Raspberry Piã§è‡ªå®…server | Part 1 NixOSã‚’install" name=twitter:title><meta content="Raspberry Piã¸ã®NixOSã®installã«ã¤ã„ã¦" name=twitter:description><meta content=https://blog.ymgyt.io/images/emoji/snowflake.png name=twitter:image><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><body><div class=world><div class=content-container><header class=blog-header-container><div class=blog-logo><a href=https://blog.ymgyt.io>Happy developing</a></div><div class=blog-nav><nav><ul><li><a href=https://blog.ymgyt.io/entry/>Entries</a><li><a href=https://blog.ymgyt.io/tags/>Tags</a><li><a href=https://blog.ymgyt.io/about/>About</a><li><a href=https://github.com/ymgyt> <img alt=Github class=icon src=https://blog.ymgyt.io/images/icon/github.svg> </a><li><a href="https://twitter.com/YAmaguchixt "> <img alt=Twitter class=icon src=https://blog.ymgyt.io/images/icon/twitter.svg> </a></ul></nav></div></header><main class=blog-main><article><header class=entry-header><h1 class=entry-title>â„ï¸ NixOSã¨Raspberry Piã§è‡ªå®…server | Part 1 NixOSã‚’install</h1><div class=entry-meta><p class=entry-meta-item>ğŸ—“ 2023-10-09<p class=entry-meta-item>ğŸ· <span class=tag><a href=https://blog.ymgyt.io/tags/nix/>nix</a></span></div></header><aside class=entry-toc><nav><ul class=entry-toc-toplevel-list><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#zhun-bei-surumono>æº–å‚™ã™ã‚‹ã‚‚ã®</a><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#nixos-imagewosd-cardnishu-kiip-mu>NixOS imageã‚’SD Cardã«æ›¸ãè¾¼ã‚€</a> <ul><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#nixos-imagenoqu-de>NixOS imageã®å–å¾—</a><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#sd-cardhenoshu-kiip-mi>SD Cardã¸ã®æ›¸ãè¾¼ã¿</a></ul><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#raspberry-pinoshe-ding>Raspberry Piã®è¨­å®š</a><li><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-install-nixos/#que-ren>ç¢ºèª</a></ul></nav></aside><div class=entry-content><p>Part 1 NixOSã‚’install (ğŸ‘ˆ ã“ã®è¨˜äº‹)<br> <a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-deploy-with-deploy-rs/>Part 2 deply-rsã§NixOS Configurationã‚’é©ç”¨</a><br> <a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-secret-management-with-ragenix/>Part 3 ragenixã§secretç®¡ç†</a><br> <a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-export-metrics-with-opentelemetry-collector/>Part 4 opentelemetry-collectorã¨openobserveã§metricsã‚’å–å¾—</a><br> <a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-get-cpu-temperature/>Part 5 CPUã®æ¸©åº¦ã‚’metricsã¨ã—ã¦å–å¾—</a><p>æœ¬è¨˜äº‹ã¯NixOSã¨Raspberry Piã§è‡ªå®…serverã‚’ã¯ã˜ã‚ã‚‹è¨˜äº‹ã®Part 1ã§ã™ã€‚ ã¾ãšã¯Raspberry Piã«NixOSã‚’installã™ã‚‹ã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã¦ã„ãã¾ã™ã€‚<br> å…ˆæ—¥ã€<a href=https://www.raspberrypi.com/products/raspberry-pi-5/>Raspberry Pi 5</a>ãŒç™ºè¡¨ã•ã‚Œã¾ã—ãŸãŒã€æœ¬è¨˜äº‹ã§åˆ©ç”¨ã™ã‚‹ã®ã¯<a href=https://www.raspberrypi.com/products/raspberry-pi-4-model-b/>Raspberry Pi 4 Model B</a>ã§ã™ã€‚RAMã¯4GBã§ã™ãŒã€8ã«ã™ã‚Œã°ã‚ˆã‹ã£ãŸã¨æ€ã£ã¦ã„ã¾ã™ã€‚å°æ•°ã¯4ã§å§‹ã‚ã¾ã—ãŸã€‚<p>Part 1ã§ã¯ã€4å°ã®Raspberry Pi(ä»¥ä¸‹raspi)ã«æ‰‹å…ƒã®machineã‹ã‚‰sshæ¥ç¶šã§ãã‚‹ã¨ã“ã‚ã¾ã§è¡Œã„ã¾ã™ã€‚sshã§ãã‚‹ã‚ˆã†ã«ãªã‚Œã°ä»Šå¾Œã®è¨­å®šã®å¤‰æ›´ã¯deploy-rsã‚’åˆ©ç”¨ã§ãã‚‹ã®ã§ã€sshã—ã¦è¨­å®šã‚’å¤‰æ›´ã¨ã„ã£ãŸä½œæ¥­ãŒãªããªã‚Šã¾ã™ã€‚<p>å®Ÿéš›ã«è‡ªåˆ†ã®raspiã®ç®¡ç†ã¯<a href=https://github.com/ymgyt/mynix/tree/main/homeserver>ã“ã®repo</a>ã§è¡Œã£ã¦ã„ã¾ã™ã€‚<figure><div class=fig-images-row><img , alt src=images/ss-btm.png></div><figcaption>4å°ã®raspi</figcaption></figure><h2 id=zhun-bei-surumono><a aria-label="Anchor link for: zhun-bei-surumono" class=zola-anchor href=#zhun-bei-surumono>æº–å‚™ã™ã‚‹ã‚‚ã®</a></h2><ul><li>Raspberry Pi <ul><li>é›»æº<li>Router/Switchã¸æ¥ç¶šã™ã‚‹ãŸã‚ã®LANã‚±ãƒ¼ãƒ–ãƒ«</ul><li>SD card(raspiåˆ†)<li>USBã‚­ãƒ¼ãƒœãƒ¼ãƒ‰<li>ãƒ¢ãƒ‹ã‚¿ãƒ¼(Micro HDMIæ¥ç¶š)</ul><p>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã¨ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¯åˆå›è¨­å®šæ™‚ã«å¿…è¦ã§ã™ã€‚<br> LANã‚±ãƒ¼ãƒ–ãƒ«ã¯ç„¡ç·šLANåˆ©ç”¨ã™ã‚‹å ´åˆã¯ä¸è¦ã§ã™ã€‚ä»Šå›ã¯æœ‰ç·šã®ã¿ä½¿ç”¨ã€‚<h2 id=nixos-imagewosd-cardnishu-kiip-mu><a aria-label="Anchor link for: nixos-imagewosd-cardnishu-kiip-mu" class=zola-anchor href=#nixos-imagewosd-cardnishu-kiip-mu>NixOS imageã‚’SD Cardã«æ›¸ãè¾¼ã‚€</a></h2><p>åŸºæœ¬çš„ã«ã¯nix.devã®<a href=https://nix.dev/tutorials/nixos/installing-nixos-on-a-raspberry-pi>Installing NixOS on a Raspberry Pi</a>ã«ã—ãŸãŒã£ã¦é€²ã‚ã¦ã„ãã¾ã™ã€‚<h3 id=nixos-imagenoqu-de><a aria-label="Anchor link for: nixos-imagenoqu-de" class=zola-anchor href=#nixos-imagenoqu-de>NixOS imageã®å–å¾—</a></h3><pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> shell nixpkgs#wget nixpkgs#zstd</span>
</span><span class="z-source z-shell z-bash">
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">wget</span></span><span class="z-meta z-function-call z-arguments z-shell"> https://hydra.nixos.org/build/226381178/download/1/nixos-sd-image-23.11pre500597.0fbe93c5a7c-aarch64-linux.img.zst</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">unzstd</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span> nixos-sd-image-23.11pre500597.0fbe93c5a7c-aarch64-linux.img.zst</span>
</span></code></pre><p>ã¾ãšimageã‚’å–å¾—ã—ã¦ãã¾ã™ã€‚imageã¯<a href=https://hydra.nixos.org/job/nixos/trunk-combined/nixos.sd_image.aarch64-linux>ã“ã¡ã‚‰</a>ã‹ã‚‰æœ€æ–°ã®ã‚‚ã®ã‚’é¸ã³ã¾ã—ãŸã€‚<h3 id=sd-cardhenoshu-kiip-mi><a aria-label="Anchor link for: sd-cardhenoshu-kiip-mi" class=zola-anchor href=#sd-cardhenoshu-kiip-mi>SD Cardã¸ã®æ›¸ãè¾¼ã¿</a></h3><p>ä»¥ä¸‹ã®commandã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰host machineã«SD cardã‚’å·®ã—è¾¼ã¿ã¾ã™ã€‚<pre class=z-code><code><span class="z-text z-plain">dmesg --follow
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">[ 3381.230145] mmc0: cannot verify signal voltage switch
</span><span class="z-text z-plain">[ 3381.334038] mmc0: new ultra high speed SDR104 SDXC card at address 59b4
</span><span class="z-text z-plain">[ 3381.349488] mmcblk0: mmc0:59b4 SD128 119 GiB
</span><span class="z-text z-plain">[ 3381.399498]  mmcblk0: p1
</span></code></pre><p>ã“ã‚Œã§SD cardãŒ<code>/dev/mmcblk0</code>ã«å¯¾å¿œã™ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚<br> ã•ãã»ã©å–å¾—ã—ãŸimageã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"> dd <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  if=nixos-sd-image-23.11pre500597.0fbe93c5a7c-aarch64-linux.img <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  of=/dev/mmcblk0 <span class="z-punctuation z-separator z-continuation z-line z-shell">\
</span></span></span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-arguments z-shell">  bs=4096 conv=fsync status=progress</span>
</span></code></pre><p><code>of=/dev/</code>ã¯<code>dmesg</code>ã®å‡ºåŠ›ã«å¯¾å¿œã•ã›ã¾ã™ã€‚<h2 id=raspberry-pinoshe-ding><a aria-label="Anchor link for: raspberry-pinoshe-ding" class=zola-anchor href=#raspberry-pinoshe-ding>Raspberry Piã®è¨­å®š</a></h2><p>raspiã«sshã™ã‚‹éš›ã«åˆ©ç”¨ã™ã‚‹key pairã‚’ä½œæˆã—ã¾ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh-keygen</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>t</span> ed25519<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>b</span> 4096<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>f</span> nixos_key<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>C</span> ymgyt</span>
</span></code></pre><p>æ¬¡ã«raspiã«é…å¸ƒã™ã‚‹<code>/etc/nixos/configuration.nix</code>ã‚’hostä¸Šã§ä½œæˆã—ã¾ã™ã€‚<br> è‡ªåˆ†ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸã€‚<pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-punctuation z-definition z-entity z-function z-2 z-nix">{</span> <span class="z-variable z-parameter z-function z-1 z-nix">config</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">pkgs</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-variable z-parameter z-function z-1 z-nix">lib</span><span class="z-keyword z-operator z-nix">,</span> <span class="z-keyword z-operator z-nix">... </span><span class="z-punctuation z-definition z-entity z-function z-nix">}</span><span class="z-punctuation z-definition z-function z-nix">:</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix"><span class="z-keyword z-other z-nix">let</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">user</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>ymgyt<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">password</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>password<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">hostname</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>rpi4-01<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-keyword z-other z-nix">in</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">boot</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">kernelPackages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">linuxKernel</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">packages</span><span class="z-keyword z-operator z-nix">.</span><span class="z-variable z-parameter z-name z-nix">linux_rpi4</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">initrd</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">availableKernelModules</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>xhci_pci<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>usbhid<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>usb_storage<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">loader</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">grub</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">generic-extlinux-compatible</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">fileSystems</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>/<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">device</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>/dev/disk/by-label/NIXOS_SD<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">fsType</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>ext4<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">options</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>noatime<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">networking</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">hostName</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">hostname</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">defaultGateway</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>192.168.10.1<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nameservers</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>8.8.8.8<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">interfaces</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">end0</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">ipv4</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">addresses</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">address</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>192.168.10.150<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">prefixLength</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-numeric z-nix">24</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">wireless</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">environment</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">systemPackages</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-keyword z-other z-nix">with</span> <span class="z-variable z-parameter z-name z-nix">pkgs</span>; <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-variable z-parameter z-name z-nix">helix</span> <span class="z-variable z-parameter z-name z-nix">git</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">services</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">openssh</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">users</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">mutableUsers</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">users</span>.<span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">user</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">isNormalUser</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">password</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">password</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">extraGroups</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>wheel<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">openssh</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">authorizedKeys</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">keys</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
</span><span class="z-source z-nix">        <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>ssh-ed25519 AAAAC3NzaC1l...EgT3Ma ymgyt<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">security</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">sudo</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">wheelNeedsPassword</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">hardware</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">enableRedistributableFirmware</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">system</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">stateVersion</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>23.11<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span>
</span></code></pre><pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">networking</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">hostName</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">hostname</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">defaultGateway</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>192.168.10.1<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">nameservers</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>8.8.8.8<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">interfaces</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">end0</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">ipv4</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">addresses</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">address</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>192.168.10.150<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">prefixLength</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-numeric z-nix">24</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">wireless</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span></code></pre><p><code>netroking.hostName</code>ã§hostnameã‚’æŒ‡å®šã—ã¾ã™ã€‚<code>rpi4-{01,02,03,04}</code>ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã—ãŸã€‚<br> <code>netroking.defaultGateway</code>ã¯ç’°å¢ƒã®è¨­å®šã«ã‚ã‚ã›ã¾ã™ã€‚<br> raspiã‚’å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹éš›ã«routerã§portã®mappingã‚’è¨­å®šã—ãŸã‹ã£ãŸã®ã§ã€raspiã®ipã‚’å›ºå®šã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã¾ãŸã€ç„¡ç·šLANã¯ç„¡åŠ¹ã«ã—ã¾ã—ãŸã€‚<p>sshã®è¨­å®šã¯ä»¥ä¸‹ã§ã™ã€‚<pre class="language-nix z-code" data-lang=nix><code class=language-nix data-lang=nix><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">services</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">openssh</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">enable</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">
</span><span class="z-source z-nix">  <span class="z-entity z-other z-attribute-name z-multipart z-nix">users</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">mutableUsers</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">false</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-entity z-other z-attribute-name z-multipart z-nix">users</span>.<span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span><span class="z-markup z-italic"><span class="z-punctuation z-section z-embedded z-begin z-nix">${</span><span class="z-variable z-parameter z-name z-nix">user</span><span class="z-punctuation z-section z-embedded z-end z-nix">}</span></span><span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-attrset-or-function z-nix">{</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">isNormalUser</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-constant z-language z-nix">true</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">password</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-variable z-parameter z-name z-nix">password</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">extraGroups</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span> <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>wheel<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span> <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">      <span class="z-entity z-other z-attribute-name z-multipart z-nix">openssh</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">authorizedKeys</span>.<span class="z-entity z-other z-attribute-name z-multipart z-nix">keys</span> <span class="z-keyword z-operator z-bind z-nix">=</span> <span class="z-punctuation z-definition z-list z-nix">[</span>
</span><span class="z-source z-nix">        <span class="z-string z-quoted z-double z-nix"><span class="z-punctuation z-definition z-string z-double z-start z-nix">"</span>ssh-ed25519 AAAAC3NzaC1l...EgT3Ma ymgyt<span class="z-punctuation z-definition z-string z-double z-end z-nix">"</span></span>
</span><span class="z-source z-nix">      <span class="z-punctuation z-definition z-list z-nix">]</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix">    <span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span><span class="z-source z-nix"><span class="z-punctuation z-definition z-attrset z-nix">}</span><span class="z-punctuation z-terminator z-bind z-nix">;</span>
</span></code></pre><p>passwordã¯ç„¡åŠ¹ã«ã—ã¦ã‚‚ã‚ˆã„ã¨æ€ã„ã¾ã™ãŒæœ€åˆã¯æœ‰åŠ¹ã«ã—ã¦ã¾ã—ãŸã€‚<br> <code>users.users.ymgyt.openssh.authorizedKeys.keys</code>ã«ã•ãã»ã©ç”Ÿæˆã—ãŸkey pairã®å…¬é–‹éµã‚’ç™»éŒ²ã—ã¾ã™ã€‚<p>ä½œæˆã—ãŸ<code>configuration.nix</code>ã‚’raspiã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«file serverã‚’ç«‹ã¡ä¸Šã’ã¾ã—ãŸã€‚<br> ä»Šå›ã¯<code>sfz</code>ã‚’åˆ©ç”¨ã—ã¾ã—ãŸãŒã€ãªã‚“ã§ã‚‚è‰¯ã„ã§ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix</span></span><span class="z-meta z-function-call z-arguments z-shell"> run nixpkgs#sfz<span class="z-keyword z-operator z-end-of-options z-shell"> --</span></span><span class="z-meta z-function-call z-arguments z-shell"> --bind 0.0.0.0 --port 8000</span>
</span></code></pre><p>ã“ã“ã‹ã‚‰ã¯ã•ãã»ã©æ›¸ãè¾¼ã‚“ã SD Cardã‚’raspiã«å·®ã—è¾¼ã‚“ã§raspiå´ã‚’æ“ä½œã—ã¾ã™ã€‚ host machineã®private addressãŒ192.168.10.10ã¨ã„ã†å‰æã§ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span></span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-support z-function z-cd z-shell">cd</span></span><span class="z-meta z-function-call z-arguments z-shell"> /etc/nixos</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">curl</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sSf</span>  curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>sSO</span> http://192.168.10.10:8000/configuration.nix</span>
</span></code></pre><p>æ¬¡ã«firmwareã®updateã‚’å®Ÿæ–½ã—ã¾ã—ãŸã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">nix-shell</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>p</span> raspberrypi-eeprom</span>
</span><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">mount</span></span><span class="z-meta z-function-call z-arguments z-shell"> /dev/disk/by-label/FIRMWARE /mnt</span>
</span><span class="z-source z-shell z-bash"><span class="z-variable z-other z-readwrite z-assignment z-shell">BOOTFS</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">/mnt</span> <span class="z-variable z-other z-readwrite z-assignment z-shell">FIRMWARE_RELEASE_STATUS</span><span class="z-keyword z-operator z-assignment z-shell">=</span><span class="z-string z-unquoted z-shell">stable</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">rpi-eeprom-update</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>d</span><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>a</span></span>
</span></code></pre><p>æœ€å¾Œã«å†èµ·å‹•ã—ã¾ã™ã€‚<pre class=z-code><code><span class="z-text z-plain">nixos-rebuild boot
</span><span class="z-text z-plain">systemctl reboot
</span></code></pre><p>ã“ã‚Œã§ä¸Šè¨˜ã®network interfaceã‚„sshã®è¨­å®šãŒé©ç”¨ã•ã‚Œã‚‹ã®ã§ä»¥ä¸‹ã®ã‚ˆã†ã«host machineã‹ã‚‰sshã§ãã‚Œã°æˆåŠŸã§ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">ssh</span></span><span class="z-meta z-function-call z-arguments z-shell"> ymgyt@192.168.10.150<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>i</span> nixos_key</span>
</span></code></pre><p>ã“ã®æ‰‹é †ã‚’æ®‹ã‚Šã®3å°ã§ã‚‚ç¹°ã‚Šè¿”ã—ã¾ã—ãŸã€‚<br> å¤‰æ›´ã™ã‚‹ã®ã¯<code>configuration.nix</code>ã®hostnameã¨network interfaceã®ç®‡æ‰€ã§ã™ã€‚<h2 id=que-ren><a aria-label="Anchor link for: que-ren" class=zola-anchor href=#que-ren>ç¢ºèª</a></h2><p>4å°ã®è¨­å®šãŒå®Œäº†ã—ãŸã®ã§ã€ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚<br> ã¾ãšhoståã§sshã§ãã‚‹ã‚ˆã†ã«<code>./etc/ssh.config</code>ã‚’ä½œæˆã—ã¾ã™ã€‚<pre class="language-text z-code" data-lang=text><code class=language-text data-lang=text><span class="z-text z-plain">Host rpi4-01
</span><span class="z-text z-plain">  Hostname 192.168.10.150
</span><span class="z-text z-plain">Host rpi4-02
</span><span class="z-text z-plain">  Hostname 192.168.10.151
</span><span class="z-text z-plain">Host rpi4-03
</span><span class="z-text z-plain">  Hostname 192.168.10.152
</span><span class="z-text z-plain">Host rpi4-04
</span><span class="z-text z-plain">  Hostname 192.168.10.153
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Host rpi4-*
</span><span class="z-text z-plain">  User ymgyt
</span><span class="z-text z-plain">  ForwardAgent yes
</span><span class="z-text z-plain">  StrictHostKeyChecking no
</span></code></pre><p>é…ç½®ã—ãŸsshã¯<code>ssh-add</code>ã—ã¦ã‚ã‚‹å‰æã§ã™ã€‚<br> æ¬¡ã«raspiãã‚Œãã‚Œã«sshã™ã‚‹ã®ã¯é¢å€’ãªã®ã§sshç”¨ã®zellij layoutã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«<code>./etc/rpi.layout.kdl</code>ã«ä½œæˆã—ã¾ã—ãŸã€‚<pre class="language-kdl z-code" data-lang=kdl><code class=language-kdl data-lang=kdl><span class="z-text z-plain">layout {
</span><span class="z-text z-plain">	pane_template name="ssh" {
</span><span class="z-text z-plain">		command "ssh"
</span><span class="z-text z-plain">	}
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">	pane size=1 borderless=true {
</span><span class="z-text z-plain">		plugin location="zellij:tab-bar"
</span><span class="z-text z-plain">	}
</span><span class="z-text z-plain">	pane split_direction="vertical" {
</span><span class="z-text z-plain">		ssh {
</span><span class="z-text z-plain">			args "ymgyt@192.168.10.150"
</span><span class="z-text z-plain">		}
</span><span class="z-text z-plain">		ssh {
</span><span class="z-text z-plain">			args "ymgyt@192.168.10.151"
</span><span class="z-text z-plain">		}
</span><span class="z-text z-plain">	}
</span><span class="z-text z-plain">	pane split_direction="vertical" {
</span><span class="z-text z-plain">		ssh {
</span><span class="z-text z-plain">			args "ymgyt@192.168.10.152"
</span><span class="z-text z-plain">		}
</span><span class="z-text z-plain">		ssh {
</span><span class="z-text z-plain">			args "ymgyt@192.168.10.153"
</span><span class="z-text z-plain">		}
</span><span class="z-text z-plain">	}
</span><span class="z-text z-plain">	pane size=2 borderless=true {
</span><span class="z-text z-plain">		plugin location="zellij:status-bar"
</span><span class="z-text z-plain">	}
</span><span class="z-text z-plain">}
</span></code></pre><p>ã“ã‚Œã§ä»¥ä¸‹ã®commandã‚’å®Ÿè¡Œã™ã‚‹ã¨å„raspiã«sshã—ãŸçŠ¶æ…‹ã®tabãŒé–‹ãã¾ã™ã€‚<pre class="language-sh z-code" data-lang=sh><code class=language-sh data-lang=sh><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">zellij</span></span><span class="z-meta z-function-call z-arguments z-shell"> action new-tab<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>layout</span> ./etc/rpi.layout.kdl</span>
</span></code></pre><p>zellijã®defaultã®keybindã§ã€Ctrl + t, sã§sync modeã«ãªã‚Štabã®panelãã‚Œãã‚Œã«ä¸€åº¦ã«å…¥åŠ›ã§ãã¾ã™ã€‚<p>ä»¥ä¸‹ã®ã‚ˆã†ã«sshã§ãã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚<figure><div class=fig-images-row><img , alt src=images/ss-hostname.png></div><figcaption>hostnamectlã®å®Ÿè¡Œ</figcaption></figure><p><a href=https://blog.ymgyt.io/entry/homeserver-with-nixos-and-raspberrypi-deploy-with-deploy-rs/>Part 2</a>ã§ã¯raspiã®è¨­å®šã‚’flakeã§ç®¡ç†ã—ã¦ã€host machineã‹ã‚‰å¤‰æ›´ã‚’é©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚</div></article></main><footer class=blog-footer><p>Â© 2024 <a href=https://blog.ymgyt.io> ymgyt </a> | Made with <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> | <a href=https://github.com/ymgyt/blog>Repository</a> | <a href=https://blog.ymgyt.io/atom.xml target=_blank title=rss> <svg viewbox="0 0 24 24" class=icon fill=none height=24 stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2 width=24 xmlns=http://www.w3.org/2000/svg><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx=5 cy=19 r=1></circle></svg> </a></footer></div></div>